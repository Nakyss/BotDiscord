<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <div class="table">
        <div class="headtab">
            <div class ="serveur"><h3>Serveur</h3></div>
            <div class ="derniere_connexion"><h3>Dernière connexion</h3></div>
            <div class ="temps_en_voc" id="voctime"><h3>Temps en Voc</h3>
                ${user.lastQuitAll && user.lastQuitAll.length > 0 && user.lastQuitAll[0].lastQuit < user.lastJoinAll[0].lastJoin?
                    `<p id="lastMaj">Dernière mise à jour il y a : ${calculateTimeDifference(user.lastJoinAll[0].lastJoin)}</p></div>` :
                    `</div>`}
            <div class ="nb_messages"><h3>Nb messages</h3></div>
            <div class="nb_spam"><h3>Nb Spam</h3></div>
        </div>
        ${user.server && Array.isArray(user.server) ? user.server.map((server) => `
            <div class="maintab">
                <div class ="serveur"><p>${server.nameServ}</p></div>
                <div class ="derniere_connexion"><p>${user.lastJoinAll.find(last => last.idServ === server.idServ) ? calculateTimeDifference(user.lastJoinAll.find(last => last.idServ === server.idServ).lastJoin) : ''}</p></div>
                <div class ="temps_en_voc"><p>${user.totalTimeAll.find(total => total.idServ === server.idServ) ? formatTotalTime(user.totalTimeAll.find(total => total.idServ === server.idServ).totalTime) : ''}</p></div>
                <div class ="nb_messages"><p>${user.nbMessage.find(message => message.idServ === server.idServ) ? user.nbMessage.find(message => message.idServ === server.idServ).nbMessage : ''}</p></div>
                <div class="nb_spam"><p>${user.nbSpamAll.find(spam => spam.idServ === server.idServ) ? user.nbSpamAll.find(spam => spam.idServ === server.idServ).nbSpam : ''}</p></div>
            </div>
        `).join('') : ''}
    </div>
    
</body>
</html>